# Malware Analysis (AnyRun::cource)

This is an markdown file just to follow up with the any run cource

What is Malware Analysis?
Let's dive into the world of malware analysis with an introductory discussion about what it is and how it can be used.

In This Lesson

- ### Definition of malware analysis
- ### The benefits of malware analysis
- ### Types of malware analysis
- ### Stages of malware analysis

---

<br>
<br>

# Definition of Malware Analysis

Malware analysis involves examining a potential malware sample to understand its type, functions, and the risks it poses.

Researchers conduct this analysis to gain crucial threat intelligence, respond to cybersecurity incidents, and enhance a company’s defenses.

### Benefits of Malware Analysis

Imagine a corporate computer infected with new malware, like ransomware. If the malware spreads across the network, it could lead to significant financial losses or loss of vital data.

Security researchers aim to

- ### identify the type of malware
- ### understand its operation
- ### assess the potential damage
- ### detect network and host indicators

The analysis helps answer key questions:

- ## What does the malware do?
- ## How can it be detected on the network?
- ## How to assess and minimize the damage?
- ## How to prevent future attacks?

In some cases, you might need additional information from external sources. For instance, extracting network and host indicators and searching them in external systems can provide more indicators of compromise and insights into the malware’s behavior that might not be evident from your sample alone.

---

<br>
<br>

# Types of Malware Analysis

- ### Static analysis

  Static analysis examines a suspicious file without executing it, offering insights that help create static signatures. For example, by analyzing code, researchers might find IP addresses and URLs pointing to a malware control server. Static analysis can also identify the file type and calculate a hash sum, useful for signature creation. However, its limitations include the risk of being misled by obfuscated code, a common technique in advanced malware.

- ### Dynamic analysis

  Dynamic analysis involves running malware samples in a controlled environment to observe the processes triggered in the system. Tools like Process Monitor and Process Explorer are commonly used. To safely perform dynamic analysis, it’s crucial to use a virtual machine, ensuring the malware doesn’t cause real damage

- ### Interactive analysis

  Interactive analysis is a more advanced form of dynamic analysis, allowing researchers to control the malware’s execution and respond to it in real time. This method offers the most realistic simulation, letting analysts interact with pop-ups or modify OS configurations during the process. It’s particularly useful when dealing with sophisticated malware, like banking Trojans, which only activate under specific conditions.

  All these actions are difficult to implement using automated analysis tools.

---

<br>
<br>

# Stages of Malware Analysis

Malware analysis can be broken down into several stages. Sometimes, only a few steps are needed, but using all of them provides the most comprehensive understanding.

![stages](./img/stages.png)

- ### Reverse code Analysis

  This advanced stage involves reverse engineering the binary file to understand its workings. It requires specialized skills and tools like disassemblers and debuggers. While some might skip this step due to its complexity, it often reveals critical insights into the malware.

- ### Interactive Behavioral analysis

  The suspicious file is executed in a controlled lab environment to observe its behavior. Analysts monitor in real-time how the malware interacts with external hosts, launches processes, and creates tasks, providing a detailed log of the program’s activities.

- ### static property analysis

  This stage involves examining static properties like strings, encoded data fragments, or compiled code sequences. The goal is to find malicious patterns, which can later become indicators of compromise.

- ### fully automated analysis

  This method quickly identifies malware by using automated systems to detect its presence. Although it’s fast, the depth of analysis is limited compared to expert reviews.

### Lesson Summary

- Malware Analysis is the process of examining a malware sample.
- There are three main types: static, dynamic, and interactive.
- Malware analysis enables you to:
- investigate security incidents
- understand the malware’s mechanisms
- obtain Indicators of Compromise (IOC)

---

<br>
<br>

![test1](./img/test1.png)

## oops my bad for sucking at this !!

<br>
<br>

# Types of Malware

The object of Malware Analysis is malware. There are many options for what it can be, and the number of options is increasing every day. And IS industry specialists have a need to share knowledge/data, and work with reports and tools that target specific classes of malware. This requires a classification or naming system. In the lesson, we will consider two approaches: the historical naming of the malware and the classification that we believe reflects the current situation with the malware well. Let's go!

In This Lesson

- ### CARO naming scheme
- ### The most popular malware families and modern classification

---

<br>
<br>

# CARO Naming Scheme

Let's start with the CARO (Computer Antivirus Research Organization) naming system/schema for malware samples. It is simple, easy to understand and is the basis for many modern classifications.

So, the scheme is built as follows:

```
[<type>://][<platform>/]<family>[.<group>][.<length>].<variant>[<modifiers>][!<comment>]
```

| **Field**                         | **Description**                                                                                                                                           |
| --------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Malware type**                  | virus, dropper, trojan, dialer, backdoor, exploit, tool, garbage                                                                                          |
| **Platform**                      | ~~V97M - macro for Office 97, Win32 - Windows 32-bit executable subsystem~~<br>**Win64 - Windows 64-bit executable subsystem**                            |
| **A family with a specific name** | (Foo ...) or a specific class-family (HLLC - High Level Language Companion Virus, HLLO - High Level Language Overwriter Virus ...)                        |
| **Group**                         | a common short name for similar malware samples in a group, but distinct from others in a family                                                          |
| **Length**                        | contains a decimal number for the length of the viral body or infecting code (depending on the type of malware)                                           |
| **Variant**                       | an even narrower division (family and group are common, but there may be some minor differences in code, etc.)                                            |
| **Modifiers**                     | data for maximum specification of threat characteristics/attributes (locale/country: De, Ru), minor specification of functional features                  |
| **Comment**                       | everything that was not included in the previous parts of the name and can specify any details that are useful for classification, threat reporting, etc. |

lets see an example

```
//example
Email-Worm.Win32/Netsky.bc.25@MM!Packed
```

This scheme was published and used for some time by vendors, laboratories, and researchers, but it never became a unified standard for decades. Instead, individual IS companies, antivirus vendors, research laboratories, and individual experts/groups of experts began to use their own or other (borrowed) malware naming schemes, and there is still no single standard.

---

<br>
<br>

# Most Popular Malware Families and Modern Classification

Here we will present one of the variants of the modern threat naming and classification scheme. It no longer contains comments (in the name) or lengths for objective reasons.

For example:

Programs that infect executable files have practically disappeared. The lengths of the files themselves and the infecting code are also no longer significant characteristics (files range from a few hundred bytes to hundreds of megabytes or more). Also, malware has since grown to the point where there is simply no way to manually describe all the individual characteristics in naming.

Why?

- Old viruses used to change other files — modern malware doesn’t usually do that.
- Malware today can be tiny or huge, so file size isn’t a useful clue.
- There are too many new threats, so names need to be short and clear.

> [!NOTE]
>
> About 50% of modern malware are Trojans because they don’t need to infect files, reducing the chance of detection.  
> Trojans appear as legitimate software, making users more likely to run them.  
> They are easier to distribute via emails, fake downloads, or malicious websites.  
> Unlike viruses, Trojans avoid triggering antivirus by not modifying existing files.  
> Their versatility makes them ideal for spying, stealing data, or installing more malware.

It should be noted that about 50% of modern malware belongs to one or another subtype of Trojans. This is due to both the lack of the need to infect files (which would lead to an active triggering of defenses) and the convenience of their distribution and effectiveness.

```
Email-Worm.Win32/Netsky.bc.25@MM!Packed
```

In modern naming, this would likely be shortened to:

```
Worm.Netsky.bc
```

Why? Because:

- We skip long technical details like how many emails it sends.
- We don't mention packing or exact platform unless necessary.
- The name just needs to give a clear idea of what it is and where it belongs

---

<br>
<br>

![PE](./img/PE.png)

So, the main types of malware:

- ## virus

  Virus - classic file malware that most often infects other executable objects/programs. Virtually uncommon nowadays. Examples: older ones (Jerusalem, OneHalf). More modern (2000-2010/2015): Sality, Virut.

- ## Worms

  Worms - malicious programs that spread independently over computer networks. Most often they exploited various vulnerabilities in protocols, network services code, and other OS/network components for distribution. Examples: older ones (ILoveYou, MsBlast, Sasser). More modern (2000-2018): Conficker, WannaCry (is a hybrid of a worm and an encryption trojan).

- ## Rootkits and Bootkits

  Rootkits and Bootkits – malicious programs that in most cases have several purposes: by performing low-level access to the operating system, they intercept system calls and modify certain system structures in the operating system. Usually, this is done to hide the presence of other malware or to gain a low-level, hard-to-detect foothold in the system. Such programs are difficult to detect and even harder to remove from the system. Examples: TDL-TDL3 (classic rootkits), TDL-4 (classic bootkit), MosaicRegressor (UEFI bootkit), BlackLotus (UEFI bootkit).

- ## Adware

  Adware - malicious program that displays annoying advertisements. These ads can slow down the Internet connection, slow down computer performance, distract the user, and bring profits to advertisers and program creators through the intrusive display of ads. Examples: there are a huge number of them (OpenCandy, Superfish, Vonteera). And these are only 3 examples out of thousands.

- ## Trojans

  The vast majority of malicious programs today are various classes/subclasses of Trojans. In one way or another, a Trojan/Trojan program is a type of malware that infiltrates a computer under the guise of legitimate software and performs a variety of malicious/undesirable actions without the user's knowledge.

---

# Classification of Trojan programs

# Classification of Trojan Programs

| **Category**                             | **General Description**                                                                                      | **Example Trojan** | **Description**                                                                      |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------ | ------------------------------------------------------------------------------------ |
| **Remote Administration Trojans (RATs)** | Give attackers full control over the infected device remotely.                                               | **RemcosRAT**      | Provides remote access and control over the victim's machine.                        |
|                                          |                                                                                                              | **Gh0st RAT**      | Used on Windows; involved in high-profile attacks on sensitive networks.             |
| **Banking Trojans**                      | Designed to steal financial information such as logins, credit card details, and online banking credentials. | **Gameover ZeuS**  | Steals bank data; part of a botnet for large-scale financial theft.                  |
|                                          |                                                                                                              | **Dridex**         | Long-running banking malware responsible for major financial losses.                 |
| **Stealers**                             | Specialized in collecting sensitive data like passwords, keystrokes, and personal info from the system.      | **Formbook**       | Steals passwords, keystrokes, and screenshots.                                       |
|                                          |                                                                                                              | **RedLine**        | Collects sensitive data from browsers, software, and systems.                        |
| **Loaders**                              | These trojans install and run other malware on the infected machine.                                         | **BazarLoader**    | Loads and launches more dangerous malware like ransomware.                           |
|                                          |                                                                                                              | **Guloader**       | Evades analysis and delivers various malware, including RATs.                        |
| **Trojan Encoder / Ransomware**          | Encrypts files and demands payment (ransom) to restore access to the victim’s data.                          | **Ryuk**           | Encrypts user files and demands ransom.                                              |
|                                          |                                                                                                              | **Cerber**         | Known for stealthy encryption and evading antivirus tools.                           |
| **Wipers**                               | Permanently destroy data on storage devices, including hard drives and system files.                         | **Shamoon**        | Destroys the disk’s MBR using direct access.                                         |
|                                          |                                                                                                              | **StoneDrill**     | Similar to Shamoon, but doesn't use drivers; more aggressive against security tools. |
| **Keyloggers**                           | Capture keystrokes typed by the user to steal credentials and other private data.                            | **HawKeye**        | A keylogger active since 2013, monitored by IBM X-Force.                             |
|                                          |                                                                                                              | **404 Keylogger**  | Subscription-based keylogger with extensive features.                                |
| **Miners**                               | Illegally use system resources (CPU, GPU) to mine cryptocurrency without the user's knowledge.               | **Coinminer**      | Mines cryptocurrency using victim’s CPU/RAM.                                         |
|                                          |                                                                                                              | **XMRig**          | Legitimate miner often repurposed for silent illegal mining.                         |

---

<br>

You can read more about the most popular malware families on the ANY.RUN [Malware Trends Tracker](https://any.run/malware-trends/) portal. Here is a ranking of the most popular malware programs and their description.

> [!NOTE]
>
> Multifunctionality and hybrid threats: the future lies in combinations
> The trend today is to blur the lines between different classes of malware. Attackers are creating hybrid threats that combine different types of functionality. For example, a Trojan Encoder can spread like a worm (WannaCry), while a stealer can steal passwords and mine cryptocurrency.

Conclusion

- Malware programs are constantly changing, so their classifications and types are constantly being updated.
- About 50% of modern malware belong to one or another subtype of Trojans.
- As part of the course, we will work with various types of malware (for example, stealers, file-free malware, ransomware) and in general, the tools given in the course will work to detect all of these classes.

---

<br>
<br>
<br>

# ANY.RUN: A Handy Tool for Malware Analysis

In this course, we’ll explore various Malware Analysis tools, including `IDA Free`, `Detect It Easy`, `Procmon`, `Process Hacker`, and `ANY.RUN`. We’ll kick things off with an introduction to ANY.RUN, an interactive sandbox that lets you safely run suspicious files and observe how they interact with the system. The insights you gain from ANY.RUN can either be used directly or serve as a foundation for deeper analysis.

The tools we will be using are as under

![tools](./img/tools.png)

---

In This Lesson

- What is ANY.RUN
- Overview of the service interface
- Setting up a virtual machine for malware analysis
- Conducting malware analysis using ANY.RUN
- Working with public reports in ANY.RUN

# What is ANY.RUN

ANY.RUN is an interactive online sandbox designed for in-depth analysis of files and URLs in a safe, isolated environment.

- ### Dynamic analysis

  You can upload files or URLs for real-time analysis, tracking changes in the file system, registry, and other elements of the operating system.

- ### Intractive Mode

  While analysing, you can interact with the virtual machine, launch programs, open files, type text, and click on interface elements, providing a hands-on approach to code analysis.

- ### Selection of differnt OS

  Choose from various operating systems, like different versions of Windows or Linux, for your analysis.

- ### Network Analysis

  Monitor network activity, including DNS requests, HTTP traffic, and connections to remote servers.

- ### Analysis Report

  Receive detailed reports on file behaviour, network activity, system changes, and more.

- ### Attribution

  ANY.RUN not only detects program activity but also identifies the threat, determining its type, often down to the family level.

---

<br>
<br>

Who Can Benefit from ANY.RUN?

ANY.RUN is a powerful and versatile tool useful for:

- Security Researchers
  Analysing and understanding new threats.
- SOC Analysts
  Investigating and responding to security incidents.
- System Administrators
  Checking the security of files and URLs before using them on a corporate network.
- Software Developers
  Testing the security of their own applications.
- Experienced Users
  Getting information about the activities of a file in the system.
- IS Students and Trainees
  Learning from real-world cases and developing hands-on skills.

---

## Exploring ANY.RUN’s Main Menu

After logging in, you’ll see ANY.RUN's main interface. Here's a quick guide:

![mainmenu](./img/main_menu.png)

## Setting Up an Analysis Task

[click](https://youtu.be/vc2zUcUX6BE) here to set up your first task

---

<br>
<br>

There are two basic ways to configure a virtual machine in ANY.RUN:

## Simple Mode (Default) vs Professional Mode

| **Simple mode (default)**                                                                                                                                                                                                                                           | **Professional mode**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| This is the “plug and play” option where you can: <br> • Upload a file by selecting it from the file system or by dragging and dropping it. <br> • Send a link for analysis. <br> • Select an operating system. <br> • Specify the bit size of the operating system | Click on “Pro mode” to access advanced settings. In pro mode, you will see a toggle for “New Virtual Machine Video Streaming”. <br><br> This feature improves the responsiveness and frame rate of the virtual machine. <br><br> Use the drop-down menus to: <br> • Select the start directory. <br> • Select the default browser for link analysis: Chrome, Firefox, Opera or Internet Explorer. <br><br> Add a CMD command to customize the startup behavior. You can enter your own command or choose from the preset ones. <br><br> The "Change extension to a valid one" option is important for processing files with a missing or invalid extension. Enabling this option allows the system to automatically change the extension, ensuring that the file starts correctly. |

---

<br>
<br>

> [!NOTE]
>
> Note that the results of your analyses will appear in the public reports by default during training.

Use the slider to set a runtime limit for your virtual machine. This feature controls how long your virtual machine will be active. The maximum time is 20 minutes. Keep in mind that some malware programs “sleep” for a while before starting their actions. This is to avoid detection of their malicious activity in the sandbox. Therefore, if the malware does not work as you expected, try to increase/extend the analysis time.

![slide timer](./img/time_slider.png)

---

<br>

Analyzing network traffic is a very important feature in ANY.RUN and using these options can also improve your research:

- MITM Proxy: This tool intercepts traffic coming in and out of the sandbox. Use it to analyze encrypted HTTPS traffic.
- Fake Net: Simulates an Internet environment without actually connecting to the network, which is useful for certain types of analysis.
- Additional Security: For added security, you have the option to route traffic through TOR or a custom VPN configuration.
- VPN Configuration: You can create and manage your own VPN configuration presets
- Resident Proxy: This feature allows you to control the geographical location of your IP address. It also masks the commercial nature of the virtual machine, making your connection to command and control servers look like an infected user.

![network](./img/network.png)

---

## Setting Up a Virtual Machine

One of the key benefits of ANY.RUN is the ability to quickly analyze a sample across multiple machine configurations.

## Providing AI Access for AI-generated Reports

In ANY.RUN, granting AI access allows you to create AI-generated reports that summarize analysis or focus on specific events, such as network activity, with files, registry and synchronization and display a summary/report of program activity

![AI](./img/AI.png)

---

## Exploring the Processes

Next, let's take a closer look at the processes that the sandbox analyzes.

You can learn more about a process if you open additional process details. Click on the process.

![process](./img/process.png)

Push the "More Info" button in the "Process details" section.

![moreinfo](./img/moreinfo.png)

Learn more information about the process. Here, you will see the events in the system.

![more process info](./img/more_process_info.png)

- Modified files
- Changes in the registry
- Synchronization objects
- HTTP requests (if any)
- Network connections
- Network threats
- Loaded modules
- Debugging information
- And commandline (i.e. what command line arguments the program was run with)
